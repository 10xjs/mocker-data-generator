require("source-map-support").install();
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("faker"));
	else if(typeof define === 'function' && define.amd)
		define(["faker"], factory);
	else if(typeof exports === 'object')
		exports["MockerData"] = factory(require("faker"));
	else
		root["MockerData"] = factory(root["faker"]);
})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';
	
	Object.defineProperty(exports, '__esModule', {
	    value: true
	});
	
	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }
	
	var _srcIndexTs = __webpack_require__(1);
	
	var _srcIndexTs2 = _interopRequireDefault(_srcIndexTs);
	
	var mocker = function mocker(config) {
	    return new _srcIndexTs2['default'](config);
	};
	
	exports['default'] = mocker;
	module.exports = exports['default'];

/***/ },
/* 1 */
/***/ function(module, exports, __webpack_require__) {

	var faker = __webpack_require__(2);
	var utils = __webpack_require__(3);
	var Mocker = (function () {
	    function Mocker(config) {
	        this.config = config;
	        this.data = {};
	    }
	    Mocker.prototype.generate = function (entity, options) {
	        var _this = this;
	        var Phase1 = new Promise(function (resolve, reject) {
	            var d = [];
	            if (Number.isInteger(options)) {
	                for (var i = 0; i < options; i++) {
	                    d.push(_this.generateEntity(_this.config[entity]));
	                }
	            }
	            else {
	                var cfg = _this.config[entity];
	                var f = options.uniqueField;
	                var possibleValues = cfg[f].values;
	                var length_1 = possibleValues.length;
	                for (var i = 0; i < length_1; i++) {
	                    var initialData = {};
	                    initialData[f] = possibleValues[i];
	                    d.push(_this.generateEntity(_this.config[entity], initialData));
	                }
	            }
	            _this.data[entity + 's'] = d;
	            resolve(_this.data);
	        });
	        return Phase1;
	    };
	    Mocker.prototype.generateEachData = function () {
	        var _this = this;
	        return new Promise(function (resolve, reject) {
	            var cfg = _this.config;
	            var keys = Object.keys(cfg);
	            for (var i = 0; i < keys.length; i++) {
	                var key = keys[i];
	                _this.data[key + 's'] = [_this.generateEntity(cfg[key])];
	            }
	            resolve(_this.data);
	        });
	    };
	    Mocker.prototype.generateEntity = function (entityConfig, initialObject) {
	        var _this = this;
	        if (initialObject === void 0) { initialObject = {}; }
	        var keys = Object.keys(entityConfig);
	        var data = initialObject;
	        var initialKeys = Object.keys(data);
	        if (utils.iamLastParent(entityConfig)) {
	            keys.map(function (k) {
	                if (initialKeys.indexOf(k) === -1) {
	                    var field = entityConfig[k];
	                    if (!utils.isConditional(k)) {
	                        if (!utils.isArray(field)) {
	                            if (field.values || field.faker || field.function) {
	                                data[k] = _this.generateField(field, data);
	                            }
	                        }
	                        else {
	                            if (field[0].values || field[0].faker || field[0].function) {
	                                data[k] = _this.generateArrayField(field[0], field[1], data);
	                            }
	                        }
	                    }
	                    else {
	                        if (!utils.isArray(field)) {
	                            var key = k.split(',');
	                            if (utils.evalWithContextData(key[0], data)) {
	                                data[key[1]] = _this.generateField(field, data);
	                            }
	                        }
	                        else {
	                            var key = k.split(',');
	                            if (utils.evalWithContextData(key[0], data)) {
	                                data[key[1]] = _this.generateArrayField(field[0], field[1], data);
	                            }
	                        }
	                    }
	                }
	            });
	        }
	        return data;
	    };
	    Mocker.prototype.generateArrayField = function (fieldConfig, arrayConfig, data) {
	        var array = [];
	        var length = utils.fieldArrayCalcLength(arrayConfig);
	        for (var i = 0; i < length; i++) {
	            array.push(this.generateField(fieldConfig, data));
	        }
	        return array;
	    };
	    Mocker.prototype.generateField = function (config, object) {
	        if (config.faker) {
	            var split = config.faker.split('.');
	            return faker[split[0]][split[1]].call();
	        }
	        else if (config.values) {
	            return faker.random.arrayElement(config.values);
	        }
	        else if (config.function) {
	            var db = this.data;
	            return config.function.call({ object: object, faker: faker, db: db });
	        }
	        else if (config.static) {
	            return config.static;
	        }
	        else {
	            return null;
	        }
	    };
	    return Mocker;
	})();
	Object.defineProperty(exports, "__esModule", { value: true });
	exports.default = Mocker;


/***/ },
/* 2 */
/***/ function(module, exports) {

	module.exports = require("faker");

/***/ },
/* 3 */
/***/ function(module, exports) {

	exports.each = function (arr, fn) {
	    for (var i = 0; i < arr.length; ++i) {
	        fn(arr[i]);
	    }
	};
	exports.iamLastChild = function (obj) {
	    if (!this.isArray(obj)) {
	        var ks = Object.keys(obj);
	        var last = null;
	        for (var i = 0; i < ks.length; i++) {
	            var key = ks[i];
	            if (this.isObject(obj[key])) {
	                last = false;
	                break;
	            }
	            else {
	                last = true;
	            }
	        }
	        return last;
	    }
	    else {
	        return true;
	    }
	};
	exports.iamLastParent = function (obj) {
	    var ks = Object.keys(obj);
	    var last = null;
	    for (var i = 0; i < ks.length; i++) {
	        var key = ks[i];
	        if (this.iamLastChild(obj[key])) {
	            last = true;
	        }
	        else {
	            last = false;
	            break;
	        }
	    }
	    return last;
	};
	exports.isConditional = function (str) {
	    var arr = str.split(',');
	    if (arr.length > 1) {
	        return true;
	    }
	    else {
	        return false;
	    }
	};
	exports.evalWithContextData = function (key, object) {
	    return eval(key);
	};
	exports.fieldArrayCalcLength = function (config) {
	    if (config.fixedLength) {
	        return config.length;
	    }
	    else {
	        return Math.floor((Math.random() * config.length) + 1);
	    }
	};
	exports.isArray = function (x) {
	    if (Object.prototype.toString.call(x) === '[object Array]') {
	        return true;
	    }
	    return false;
	};
	exports.isObject = function (x) {
	    if (Object.prototype.toString.call(x) === '[object Object]') {
	        return true;
	    }
	    return false;
	};


/***/ }
/******/ ])
});
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCBjN2EzY2I0Yzc4OTQ5OGFmZjZiNyIsIndlYnBhY2s6Ly8vLi9saWIvbWFpbi5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZmFrZXJcIiIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOlsiTW9ja2VyIiwiTW9ja2VyLmNvbnN0cnVjdG9yIiwiTW9ja2VyLmdlbmVyYXRlIiwiTW9ja2VyLmdlbmVyYXRlRWFjaERhdGEiLCJNb2NrZXIuZ2VuZXJhdGVFbnRpdHkiLCJNb2NrZXIuZ2VuZXJhdGVBcnJheUZpZWxkIiwiTW9ja2VyLmdlbmVyYXRlRmllbGQiXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsTztBQ1ZBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozt1Q0N0Q21CLENBQWlCOzs7O0FBQ3BDLEtBQU0sTUFBTSxHQUFHLFNBQVQsTUFBTSxDQUFZLE1BQU0sRUFBRTtBQUM1QixZQUFPLDRCQUFXLE1BQU0sQ0FBQztFQUM1Qjs7c0JBRWMsTUFBTTs7Ozs7OztBQ0xyQixLQUFPLEtBQUssdUJBQVcsQ0FBTyxDQUFDO0FBQy9CLEtBQVksS0FBSyx1QkFBTSxDQUV2QixDQUFDLENBRmtDO0FBRW5DO0tBRUlBLGdCQUFvQkEsTUFBV0E7U0FBWEMsV0FBTUEsR0FBTkEsTUFBTUEsQ0FBS0E7U0FEeEJBLFNBQUlBLEdB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O1NBQ3hELE1BQU0sQ0FBQyxJQUFJO0tBQ2YsQ0FBQztLQUNELE1BQU0sQ0FBQyxLQUFLO0FBQ2hCLEVBQUM7QUFFWSxpQkFBUSxHQUFHLFVBQVUsQ0FBQztLQUMvQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssaUJBQWlCLENBQUMsRUFBQztTQUN6RCxNQUFNLENBQUMsSUFBSTtLQUNmLENBQUM7S0FDRCxNQUFNLENBQUMsS0FBSztBQUNoQixFQUFDIiwiZmlsZSI6Im1vY2tlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImZha2VyXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcImZha2VyXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIk1vY2tlckRhdGFcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJmYWtlclwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiTW9ja2VyRGF0YVwiXSA9IGZhY3Rvcnkocm9vdFtcImZha2VyXCJdKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMl9fKSB7XG5yZXR1cm4gXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiB3ZWJwYWNrL2Jvb3RzdHJhcCBjN2EzY2I0Yzc4OTQ5OGFmZjZiN1xuICoqLyIsImltcG9ydCBNb2NrZXIgZnJvbSAnLi4vc3JjL2luZGV4LnRzJ1xuY29uc3QgbW9ja2VyID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgcmV0dXJuIG5ldyBNb2NrZXIoY29uZmlnKVxufVxuXG5leHBvcnQgZGVmYXVsdCBtb2NrZXJcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vfi9qc2NzLWxvYWRlciEuL2xpYi9tYWluLmpzXG4gKiovIiwiaW1wb3J0IGZha2VyID0gcmVxdWlyZSgnZmFrZXInKVxuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi91dGlscy50cydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9ja2VyIHtcbiAgICBwdWJsaWMgZGF0YSA9IHt9XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWc6IGFueSkge31cblxuICAgIGdlbmVyYXRlKGVudGl0eTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICAgICAgbGV0IFBoYXNlMSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHZhciBkID0gW11cbiAgICAgICAgICAgIGlmICgoTnVtYmVyIGFzIGFueSkuaXNJbnRlZ2VyKG9wdGlvbnMpKXtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkLnB1c2goIHRoaXMuZ2VuZXJhdGVFbnRpdHkodGhpcy5jb25maWdbZW50aXR5XSkgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IGNmZyA9IHRoaXMuY29uZmlnW2VudGl0eV1cbiAgICAgICAgICAgICAgICBsZXQgZiA9IG9wdGlvbnMudW5pcXVlRmllbGRcbiAgICAgICAgICAgICAgICBsZXQgcG9zc2libGVWYWx1ZXMgPSBjZmdbZl0udmFsdWVzXG4gICAgICAgICAgICAgICAgbGV0IGxlbmd0aCA9IHBvc3NpYmxlVmFsdWVzLmxlbmd0aFxuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgaW5pdGlhbERhdGEgPSB7fVxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsRGF0YVtmXSA9IHBvc3NpYmxlVmFsdWVzW2ldXG4gICAgICAgICAgICAgICAgICAgIGQucHVzaCggdGhpcy5nZW5lcmF0ZUVudGl0eSh0aGlzLmNvbmZpZ1tlbnRpdHldLCBpbml0aWFsRGF0YSkgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5kYXRhW2VudGl0eSArICdzJ10gPSBkXG4gICAgICAgICAgICByZXNvbHZlKHRoaXMuZGF0YSlcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIFBoYXNlMVxuICAgIH1cblxuICAgIGdlbmVyYXRlRWFjaERhdGEoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2ZnID0gdGhpcy5jb25maWdcbiAgICAgICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMoY2ZnKVxuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQga2V5ID0ga2V5c1tpXVxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YVtrZXkgKyAncyddID0gW3RoaXMuZ2VuZXJhdGVFbnRpdHkoY2ZnW2tleV0pXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKHRoaXMuZGF0YSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBnZW5lcmF0ZUVudGl0eShlbnRpdHlDb25maWc6IE9iamVjdCwgaW5pdGlhbE9iamVjdDogT2JqZWN0ID0ge30gKXtcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhlbnRpdHlDb25maWcpXG4gICAgICAgIGxldCBkYXRhID0gaW5pdGlhbE9iamVjdFxuICAgICAgICBsZXQgaW5pdGlhbEtleXMgPSBPYmplY3Qua2V5cyhkYXRhKVxuXG4gICAgICAgIGlmICh1dGlscy5pYW1MYXN0UGFyZW50KGVudGl0eUNvbmZpZykpe1xuICAgICAgICAgICAga2V5cy5tYXAoKGspID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEtleXMuaW5kZXhPZihrKSA9PT0gLTEpe1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGQgPSBlbnRpdHlDb25maWdba11cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXV0aWxzLmlzQ29uZGl0aW9uYWwoaykpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhdXRpbHMuaXNBcnJheShmaWVsZCkgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQudmFsdWVzIHx8IGZpZWxkLmZha2VyIHx8IGZpZWxkLmZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFba10gPSB0aGlzLmdlbmVyYXRlRmllbGQoZmllbGQsIGRhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRbMF0udmFsdWVzIHx8IGZpZWxkWzBdLmZha2VyIHx8IGZpZWxkWzBdLmZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFba10gPSB0aGlzLmdlbmVyYXRlQXJyYXlGaWVsZChmaWVsZFswXSwgZmllbGRbMV0sIGRhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhdXRpbHMuaXNBcnJheShmaWVsZCkgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gay5zcGxpdCgnLCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV0aWxzLmV2YWxXaXRoQ29udGV4dERhdGEoa2V5WzBdLCBkYXRhKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFba2V5WzFdXSA9IHRoaXMuZ2VuZXJhdGVGaWVsZChmaWVsZCwgZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBrLnNwbGl0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXRpbHMuZXZhbFdpdGhDb250ZXh0RGF0YShrZXlbMF0sIGRhdGEpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtrZXlbMV1dID0gdGhpcy5nZW5lcmF0ZUFycmF5RmllbGQoZmllbGRbMF0sIGZpZWxkWzFdLCBkYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0YVxuICAgIH1cblxuICAgIGdlbmVyYXRlQXJyYXlGaWVsZChmaWVsZENvbmZpZywgYXJyYXlDb25maWcsIGRhdGE/KSB7XG4gICAgICAgIGxldCBhcnJheSA9IFtdXG4gICAgICAgIGxldCBsZW5ndGggPSB1dGlscy5maWVsZEFycmF5Q2FsY0xlbmd0aChhcnJheUNvbmZpZylcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJyYXkucHVzaCh0aGlzLmdlbmVyYXRlRmllbGQoZmllbGRDb25maWcsIGRhdGEpKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnJheVxuICAgIH1cblxuICAgIGdlbmVyYXRlRmllbGQoY29uZmlnLCBvYmplY3Q/KSB7XG4gICAgICAgIGlmIChjb25maWcuZmFrZXIpe1xuICAgICAgICAgICAgbGV0IHNwbGl0ID0gY29uZmlnLmZha2VyLnNwbGl0KCcuJylcbiAgICAgICAgICAgIHJldHVybiAoZmFrZXIgYXMgYW55KVtzcGxpdFswXV1bc3BsaXRbMV1dLmNhbGwoKVxuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy52YWx1ZXMpIHtcbiAgICAgICAgICAgIHJldHVybiAoZmFrZXIgYXMgYW55KS5yYW5kb20uYXJyYXlFbGVtZW50KGNvbmZpZy52YWx1ZXMpXG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmZ1bmN0aW9uKSB7XG4gICAgICAgICAgICBsZXQgZGIgPSB0aGlzLmRhdGFcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZnVuY3Rpb24uY2FsbCh7b2JqZWN0LCBmYWtlciwgZGJ9KVxuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuc3RhdGljXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG4gICAgfVxuXG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy9pbmRleC50c1xuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImZha2VyXCIpO1xuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogZXh0ZXJuYWwgXCJmYWtlclwiXG4gKiogbW9kdWxlIGlkID0gMlxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiZXhwb3J0IGNvbnN0IGVhY2ggPSBmdW5jdGlvbihhcnIsIGZuKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7XG4gICAgZm4oYXJyW2ldKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgaWFtTGFzdENoaWxkID0gZnVuY3Rpb24gKG9iail7XG4gICAgaWYgKCF0aGlzLmlzQXJyYXkob2JqKSkge1xuICAgICAgICBsZXQga3MgPSBPYmplY3Qua2V5cyhvYmopXG4gICAgICAgIGxldCBsYXN0ID0gbnVsbFxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBrZXkgPSBrc1tpXVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNPYmplY3Qob2JqW2tleV0pKXtcbiAgICAgICAgICAgICAgICBsYXN0ID0gZmFsc2VcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXN0ID0gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsYXN0XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBpYW1MYXN0UGFyZW50ID0gZnVuY3Rpb24gKG9iail7XG4gICAgbGV0IGtzID0gT2JqZWN0LmtleXMob2JqKVxuICAgIGxldCBsYXN0ID0gbnVsbFxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQga2V5ID0ga3NbaV1cbiAgICAgICAgaWYgKHRoaXMuaWFtTGFzdENoaWxkKG9ialtrZXldKSl7XG4gICAgICAgICAgICBsYXN0ID0gdHJ1ZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGFzdCA9IGZhbHNlXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBsYXN0XG59XG5cbmV4cG9ydCBjb25zdCBpc0NvbmRpdGlvbmFsID0gZnVuY3Rpb24gKHN0cjogU3RyaW5nKXtcbiAgICB2YXIgYXJyID0gc3RyLnNwbGl0KCcsJylcbiAgICBpZiAoYXJyLmxlbmd0aCA+IDEpe1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV2YWxXaXRoQ29udGV4dERhdGEgPSAgZnVuY3Rpb24gKGtleSwgb2JqZWN0KXtcbiAgICAvLyBJbiB0aGlzIHdheSwgd2UgY2FuIHBhc3Mgb2JqZWN0IGFuZCB1c2UgaW5zaWRlIHRoZSBldmFsIHN0cmluZ1xuICAgIHJldHVybiBldmFsKGtleSlcbn1cblxuZXhwb3J0IGNvbnN0IGZpZWxkQXJyYXlDYWxjTGVuZ3RoID0gZnVuY3Rpb24gKGNvbmZpZyl7XG4gICAgaWYgKGNvbmZpZy5maXhlZExlbmd0aCl7XG4gICAgICAgIHJldHVybiBjb25maWcubGVuZ3RoXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiBjb25maWcubGVuZ3RoKSArIDEpXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgaXNBcnJheSA9IGZ1bmN0aW9uICh4KXtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHgpID09PSAnW29iamVjdCBBcnJheV0nKXtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBjb25zdCBpc09iamVjdCA9IGZ1bmN0aW9uICh4KXtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHgpID09PSAnW29iamVjdCBPYmplY3RdJyl7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHJldHVybiBmYWxzZVxufVxuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9zcmMvdXRpbHMudHNcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9