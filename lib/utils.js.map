{"version":3,"sources":["../src/utils.js"],"names":["isArray","arg","Object","prototype","toString","call","isObject","evalWithContextData","key","object","db","eval","fieldArrayCalcLength","config","fixedArrayLength","schema","length","fixedLength","Math","floor","random","iamLastParent","obj","last","ks","keys","i","k","iamLastChild","parent","el","isConditional","str","arr","split","cleanVirtuals","paths","options","objectCleaner","path","lvls","symbol","dest","field","getOwnPropertyNames","pop","join","forEachPath","forPaths","it","res","calculateKey","conditionalField","acc","result"],"mappings":";;;;;AAAO,IAAMA,4BAAU,SAAVA,OAAU,CAASC,GAAT,EAAc;AACjC,WAAOC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,gBAA/C;AACH,CAFM;;AAIA,IAAMK,8BAAW,SAAXA,QAAW,CAAUL,GAAV,EAAe;AACnC,WAAOC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,iBAA/C;AACH,CAFM;;AAIA,IAAMM,oDAAuB,SAAvBA,mBAAuB,CAAUC,GAAV,EAAeC,MAAf,EAAuBC,EAAvB,EAA2B;AAC3D;AACA,WAAOC,KAAKH,GAAL,CAAP;AACH,CAHM;;AAKA,IAAMI,sDAAuB,SAAvBA,oBAAuB,CAAUC,MAAV,EAAkBC,gBAAlB,EAAoCC,MAApC,EAA4C;AAC5E,QAAIC,eAAJ;AACA,QAAI,OAAOH,OAAOG,MAAd,KAAyB,UAA7B,EAAyC;AACrCA,iBAASH,OAAOG,MAAP,CAAcX,IAAd,CAAmBU,MAAnB,CAAT;AACH,KAFD,MAEO,IAAIF,OAAOI,WAAX,EAAwB;AAC3BD,iBAASH,OAAOG,MAAP,GAAgBF,gBAAzB;AACH,KAFM,MAEA;AACHE,iBAASE,KAAKC,KAAL,CAAYD,KAAKE,MAAL,KAAgBP,OAAOG,MAAxB,GAAkC,CAA7C,CAAT;AACH;AACD,WAAOA,MAAP;AACH,CAVM;;AAYA,IAAMK,wCAAgB,SAAhBA,aAAgB,CAASC,GAAT,EAAc;AACvC,QAAIC,OAAO,KAAX;AACA,QAAIjB,SAASgB,GAAT,CAAJ,EAAmB;AACf,YAAIE,KAAKtB,OAAOuB,IAAP,CAAYH,GAAZ,CAAT;;AAEA,aAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIF,GAAGR,MAAvB,EAA+BU,GAA/B,EAAoC;AAChC,gBAAIC,IAAIH,GAAGE,CAAH,CAAR;AACAH,mBAAOK,aAAaN,GAAb,EAAkBK,CAAlB,CAAP;AACA,gBAAI,CAACJ,IAAL,EAAU;AACN;AACH;AACJ;AACJ,KAVD,MAUO;AACHA,eAAO,IAAP;AACH;AACD,WAAOA,IAAP;AACH,CAhBM;;AAkBA,IAAMK,sCAAe,SAAfA,YAAe,CAAUC,MAAV,EAAkBF,CAAlB,EAAqB;AAC7C,QAAI3B,QAAQ6B,OAAOF,CAAP,CAAR,CAAJ,EAAwB;AACpB,YAAIJ,OAAO,KAAX;;AAEA,YAAIM,OAAOF,CAAP,EAAUX,MAAV,KAAqB,CAAzB,EAA2B;AACvB,mBAAO,IAAP;AACH;;AAED,aAAK,IAAIU,IAAI,CAAb,EAAgBA,IAAIG,OAAOF,CAAP,EAAUX,MAA9B,EAAsCU,GAAtC,EAA2C;AACvC,gBAAII,KAAKD,OAAOF,CAAP,EAAUD,CAAV,CAAT;AACAH,mBAAO,CAACjB,SAASwB,EAAT,CAAR;AACA,gBAAIP,IAAJ,EAAS;AACL;AACH;AACJ;AACD,eAAOA,IAAP;AACH,KAfD,MAeO;AACH,eAAO,CAACjB,SAASuB,OAAOF,CAAP,CAAT,CAAR;AACH;AACJ,CAnBM;;AAqBA,IAAMI,wCAAgB,SAAhBA,aAAgB,CAAUC,GAAV,EAAe;AACxC,QAAIC,MAAMD,IAAIE,KAAJ,CAAU,GAAV,CAAV;AACA,WAAOD,IAAIjB,MAAJ,GAAa,CAApB;AACH,CAHM;;AAKA,IAAMmB,wCAAgB,SAAhBA,aAAgB,CAAUC,KAAV,EAAiB3B,MAAjB,EAAyB4B,OAAzB,EAAkC;;AAE3D;AACA,QAAIC,wCAAgB,SAAhBA,aAAgB,CAAWC,IAAX,EAAiBjB,GAAjB,EAAsBe,OAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AACZG,4BADY,GACLD,KAAKL,KAAL,CAAWG,QAAQI,MAAnB,CADK;AAEZC,4BAFY,GAELpB,GAFK;;AAAA,8BAIZ,CAACkB,IAAD,IAASA,KAAKxB,MAAL,KAAgB,CAJb;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,4BAKXM,GALW;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAOPI,yBAPO,GAOH,CAPG;;AAAA;AAAA,8BAOAA,IAAGc,KAAKxB,MAPR;AAAA;AAAA;AAAA;;AAQR2B,6BARQ,GAQAH,KAAKd,CAAL,CARA;;AAAA,8BASRA,MAAMc,KAAKxB,MAAL,GAAc,CAApB,IAAyB0B,KAAKC,KAAL,CATjB;AAAA;AAAA;AAAA;;AAAA,8BAUJzC,OAAO0C,mBAAP,CAA2BF,KAAKC,KAAL,CAA3B,EAAwC3B,MAAxC,GAAiD,CAV7C;AAAA;AAAA;AAAA;;AAWJ,+BAAO0B,KAAKC,KAAL,CAAP;AAXI;;AAAA;AAAA;AAAA;;AAAA;AAeRD,+BAAOA,KAAKC,KAAL,CAAP;;AAfQ;AAOgBjB,2BAPhB;AAAA;AAAA;;AAAA;AAkBhBc,6BAAKK,GAAL;;AAlBgB,8BAoBZL,KAAKxB,MAAL,GAAc,CApBF;AAAA;AAAA;AAAA;;AAAA,sDAqBLsB,cAAcE,KAAKM,IAAL,CAAUT,QAAQI,MAAlB,CAAd,EAAyCnB,GAAzC,EAA8Ce,OAA9C,CArBK;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAhBC,aAAgB;AAAA,KAAhB,CAAJ;;AA2BA,QAAIS,sCAAc,SAAdA,WAAc,CAAWR,IAAX,EAAiB9B,MAAjB,EAAyB4B,OAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AACVG,4BADU,GACHD,KAAKL,KAAL,CAAWG,QAAQI,MAAnB,CADG;AAEVC,4BAFU,GAEHjC,MAFG;AAILiB,yBAJK,GAID,CAJC;;AAAA;AAAA,8BAIEA,IAAIc,KAAKxB,MAJX;AAAA;AAAA;AAAA;;AAKN2B,6BALM,GAKEH,KAAKd,CAAL,CALF;;AAAA,8BAMNA,MAAMc,KAAKxB,MAAL,GAAc,CANd;AAAA;AAAA;AAAA;;AAON;AACA,+BAAO0B,KAAKC,KAAL,CAAP;AACA;AATM,uDAUCL,cAAcC,IAAd,EAAoB9B,MAApB,EAA4B4B,OAA5B,CAVD;;AAAA;AAAA;AAAA;;AAAA;AAYNK,+BAAOA,KAAKC,KAAL,CAAP;;AAZM;AAImBjB,2BAJnB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAdqB,WAAc;AAAA,KAAd,CAAJ;;AAiBA,QAAIC,mCAAW,SAAXA,QAAW,CAAWZ,KAAX,EAAkB3B,MAAlB,EAA0B4B,OAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AACFX,yBADE,GACE,CADF;;AAAA;AAAA,8BACKA,IAAIU,MAAMpB,MADf;AAAA;AAAA;AAAA;;AAEHuB,4BAFG,GAEIH,MAAMV,CAAN,CAFJ;AAAA,uDAGAqB,YAAYR,IAAZ,EAAkB9B,MAAlB,EAA0B4B,OAA1B,CAHA;;AAAA;AACuBX,2BADvB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAXsB,QAAW;AAAA,KAAX,CAAJ;;AAOA,QAAIC,KAAKD,SAASZ,KAAT,EAAgB3B,MAAhB,EAAwB4B,OAAxB,CAAT;AAtD2D;AAAA;AAAA;;AAAA;AAuD3D,6BAAkBY,EAAlB,8HAAsB;AAAA,gBAAXC,GAAW;AAAG;AAvDkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAyD3D,WAAOzC,MAAP;AACH,CA1DM;;AA4DA,IAAM0C,sCAAe,SAAfA,YAAe,CAASxB,CAAT,EAAW;AACnC,QAAI,CAACI,cAAcJ,CAAd,CAAL,EAAsB;AAClB,eAAOA,CAAP;AACH,KAFD,MAEO;AACH,YAAInB,MAAMmB,EAAEO,KAAF,CAAQ,GAAR,CAAV;AACA,eAAO1B,IAAI,CAAJ,CAAP;AACH;AACJ,CAPM;;AASA,IAAM4C,8CAAmB,SAAnBA,gBAAmB,CAAUC,GAAV,EAAe1B,CAAf,EAAkB2B,MAAlB,EAA0B7C,MAA1B,EAAiC;AAC7D,QAAI,CAACsB,cAAcJ,CAAd,CAAL,EAAsB;AAClB0B,YAAI1B,CAAJ,IAAS2B,MAAT;AACH,KAFD,MAEO;AACH,YAAI9C,MAAMmB,EAAEO,KAAF,CAAQ,GAAR,CAAV;AACA,YAAI3B,oBAAoBC,IAAI,CAAJ,CAApB,EAA4BC,MAA5B,CAAJ,EAAwC;AACpC4C,gBAAI7C,IAAI,CAAJ,CAAJ,IAAc8C,MAAd;AACH;AACJ;AACD;AACH,CAVM","file":"utils.js","sourcesContent":["export const isArray = function(arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n}\n\nexport const isObject = function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Object]';\n}\n\nexport const evalWithContextData =  function (key, object, db) {\n    // In this (way, we can pass object and use inside the eval string\n    return eval(key)\n}\n\nexport const fieldArrayCalcLength = function (config, fixedArrayLength, schema) {\n    let length\n    if (typeof config.length === 'function') {\n        length = config.length.call(schema);\n    } else if (config.fixedLength) {\n        length = config.length - fixedArrayLength\n    } else {\n        length = Math.floor((Math.random() * config.length) + 1)\n    }\n    return length\n}\n\nexport const iamLastParent = function(obj) {\n    let last = false\n    if (isObject(obj)) {\n        let ks = Object.keys(obj)\n\n        for (let i = 0; i < ks.length; i++) {\n            let k = ks[i]\n            last = iamLastChild(obj, k)\n            if (!last){\n                break\n            }\n        }\n    } else {\n        last = true\n    }\n    return last\n}\n\nexport const iamLastChild = function (parent, k) {\n    if (isArray(parent[k])) {\n        let last = false\n\n        if (parent[k].length === 0){\n            return true\n        }\n\n        for (let i = 0; i < parent[k].length; i++) {\n            let el = parent[k][i]\n            last = !isObject(el)\n            if (last){\n                break\n            }\n        }\n        return last\n    } else {\n        return !isObject(parent[k])\n    }\n}\n\nexport const isConditional = function (str) {\n    let arr = str.split(',')\n    return arr.length > 1\n}\n\nexport const cleanVirtuals = function (paths, object, options) {\n\n    //clean specific paths\n    let objectCleaner = function *(path, obj, options) {\n        let lvls = path.split(options.symbol)\n        let dest = obj\n\n        if (!lvls || lvls.length === 0) { return }\n        if (!obj) { return }\n\n        for (var i = 0; i< lvls.length; i++) {\n            let field = lvls[i]\n            if (i === lvls.length - 1 && dest[field]) {\n                if (Object.getOwnPropertyNames(dest[field]).length < 1) {\n                    delete dest[field]\n                    break\n                }\n            } else {\n                dest = dest[field]\n            }\n        }\n        lvls.pop()\n\n        if (lvls.length > 0){\n            yield *objectCleaner(lvls.join(options.symbol), obj, options)\n        } else {\n            return\n        }\n    }\n\n    let forEachPath = function *(path, object, options) {\n        let lvls = path.split(options.symbol)\n        let dest = object\n\n        for (var i = 0; i < lvls.length; i++) {\n            let field = lvls[i]\n            if (i === lvls.length - 1) {\n                // delete specific path\n                delete dest[field]\n                //clean specific path\n                yield *objectCleaner(path, object, options)\n            } else {\n                dest = dest[field]\n            }\n        }\n    }\n\n    let forPaths = function *(paths, object, options) {\n        for (var i = 0; i < paths.length; i++) {\n            let path = paths[i]\n            yield *forEachPath(path, object, options)\n        }\n    }\n\n    let it = forPaths(paths, object, options);\n    for (const res of it) { }\n\n    return object\n}\n\nexport const calculateKey = function(k){\n    if (!isConditional(k)){\n        return k\n    } else {\n        let key = k.split(',')\n        return key[0]\n    }\n}\n\nexport const conditionalField = function (acc, k, result, object){\n    if (!isConditional(k)){\n        acc[k] = result\n    } else {\n        let key = k.split(',')\n        if (evalWithContextData(key[0], object)){\n            acc[key[1]] = result\n        }\n    }\n    return\n}\n"]}